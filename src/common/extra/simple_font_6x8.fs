\ Copyright (c) 2022-2024 Travis Bemann
\ 
\ Permission is hereby granted, free of charge, to any person obtaining a copy
\ of this software and associated documentation files (the "Software"), to deal
\ in the Software without restriction, including without limitation the rights
\ to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
\ copies of the Software, and to permit persons to whom the Software is
\ furnished to do so, subject to the following conditions:
\ 
\ The above copyright notice and this permission notice shall be included in
\ all copies or substantial portions of the Software.
\ 
\ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
\ IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
\ FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
\ AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
\ LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
\ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
\ SOFTWARE.

begin-module zscript-simple-font-6x8

  zscript-oo import
  zscript-font import

  begin-module zscript-simple-font-6x8-internal

    \ Our character columns
    6 constant char-cols
    
    \ Our character rows
    8 constant char-rows
    
    \ Our character count
    128 constant char-count

    \ Parse a row the font
    : %% ( -- )
      0 ref { data }
      token dup 0<> averts x-token-expected
      data 1 [: { c data }
        data ref@ 1 lshift data ref!
        c [char] # = if data ref@ 1 or data ref! then
      ;] bind iter
      data ref@ c,
    ;
        
    \ Our font data
    begin-const-bytes char-data

      char ! c,
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ......
      %% ..#...
      %% ......

      char " c,
      %% .#.#..
      %% .#.#..
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......
      
      char # c,
      %% .#.#..
      %% .#.#..
      %% #####.
      %% .#.#..
      %% #####.
      %% .#.#..
      %% .#.#..
      %% ......

      char $ c,
      %% .###..
      %% #.#.#.
      %% #.#...
      %% .###..
      %% ..#.#.
      %% #.#.#.
      %% .###..
      %% ......

      char % c,
      %% .#..#.
      %% #.#.#.
      %% .#.#..
      %% ..#...
      %% .#.#..
      %% #.#.#.
      %% #..#..
      %% ......

      char & c,
      %% ..#...
      %% .#.#..
      %% #..##.
      %% .##...
      %% #...#.
      %% #..#..
      %% .##..
      %% ......

      char ' c,
      %% ..#...
      %% ..#...
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......

      char ( c,
      %% ...#..
      %% ..#...
      %% .#....
      %% .#....
      %% .#....
      %% ..#...
      %% ...#..
      %% ......

      char ) c,
      %% .#....
      %% ..#...
      %% ...#..
      %% ...#..
      %% ...#..
      %% ..#...
      %% .#....
      %% ......

      char * c,
      %% ..#...
      %% ..#...
      %% #####.
      %% .#.#..
      %% #...#.
      %% ......
      %% ......
      %% ......

      char + c,
      %% ......
      %% ......
      %% ..#...
      %% ..#...
      %% #####.
      %% ..#...
      %% ..#...
      %% ......

      char , c,
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......
      %% ...#..
      %% ..#...

      char - c,
      %% ......
      %% ......
      %% ......
      %% ......
      %% .###..
      %% ......
      %% ......
      %% ......    

      char . c,
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......
      %% ..#...
      %% ......    

      char / c,
      %% ....#.
      %% ...#..
      %% ...#..
      %% ..#...
      %% .#....
      %% .#....
      %% #.....
      %% ......    
      
      char 0 c,
      %% .###..
      %% #..##.
      %% #..##.
      %% #.#.#.
      %% ##..#.
      %% ##..#.
      %% .###..
      %% ......    

      char 1 c,
      %% ..#...
      %% .##...
      %% #.#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% #####.
      %% ......    
      
      char 2 c,
      %% .###..
      %% #...#.
      %% ....#.
      %% ..##..
      %% .#....
      %% #.....
      %% #####.
      %% ......    

      char 3 c,
      %% .###..
      %% #...#.
      %% ....#.
      %% ..##..
      %% ....#.
      %% #...#.
      %% .###..
      %% ......    

      char 4 c,
      %% ...#..
      %% ..##..
      %% .#.#..
      %% #..#..
      %% #####.
      %% ...#..
      %% ...#..
      %% ......    
      
      char 5 c,
      %% ####..
      %% #.....
      %% #.....
      %% ####..
      %% ....#.
      %% #...#.
      %% .###..
      %% ......    
      
      char 6 c,
      %% ..##..
      %% .#..#.
      %% #.....
      %% ####..
      %% #...#.
      %% #...#.
      %% .###..
      %% ......    

      char 7 c,
      %% #####.
      %% ....#.
      %% ...#..
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ......    

      char 8 c,
      %% .###..
      %% #...#.
      %% #...#.
      %% .###..
      %% #...#.
      %% #...#.
      %% .###..
      %% ......    

      char 9 c,
      %% .###..
      %% #...#.
      %% #...#.
      %% .####.
      %% ....#.
      %% #...#.
      %% .###..
      %% ......    

      char : c,
      %% ......
      %% ......
      %% ......
      %% ..#...
      %% ......
      %% ......
      %% ..#...
      %% ......    

      char ; c,
      %% ......
      %% ......
      %% ......
      %% ..#...
      %% ......
      %% ......
      %% ..#...
      %% .#....    

      char < c,
      %% ...#..
      %% ..#...
      %% .#....
      %% #.....
      %% .#....
      %% ..#...
      %% ...#..
      %% ......    

      char = c,
      %% ......
      %% ......
      %% ......
      %% .###..
      %% ......
      %% .###..
      %% ......
      %% ......    

      char > c,
      %% #.....
      %% .#....
      %% ..#...
      %% ...#..
      %% ..#...
      %% .#....
      %% #.....
      %% ......    

      char ? c,
      %% .###..
      %% #...#.
      %% ....#.
      %% ...#..
      %% ..#...
      %% ......
      %% ..#...
      %% ......    

      char @ c,
      %% .###..
      %% #...#.
      %% #.###.
      %% #.#.#.
      %% #.##..
      %% #.....
      %% .###..
      %% ......    

      char A c,
      %% ..#...
      %% .#.#..
      %% #...#.
      %% #####.
      %% #...#.
      %% #...#.
      %% #...#.
      %% ......    

      char B c,
      %% ####..
      %% #...#.
      %% #...#.
      %% ####..
      %% #...#.
      %% #...#.
      %% ####..
      %% ......    

      char C c,
      %% ..##..
      %% .#..#.
      %% #.....
      %% #.....
      %% #.....
      %% .#..#.
      %% ..##..
      %% ......    

      char D c,
      %% ###...
      %% #..#..
      %% #...#.
      %% #...#.
      %% #...#.
      %% #..#..
      %% ###...
      %% ......    

      char E c,
      %% #####.
      %% #.....
      %% #.....
      %% #####.
      %% #.....
      %% #.....
      %% #####.
      %% ......    

      char F c,
      %% #####.
      %% #.....
      %% #.....
      %% #####.
      %% #.....
      %% #.....
      %% #.....
      %% ......    

      char G c,
      %% ..##..
      %% .#..#.
      %% #.....
      %% #.....
      %% #..##.
      %% .#..#.
      %% ..##..
      %% ......    

      char H c,
      %% #...#.
      %% #...#.
      %% #...#.
      %% #####.
      %% #...#.
      %% #...#.
      %% #...#.
      %% ......    

      char I c,
      %% .###..
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% .###..
      %% ......    

      char J c,
      %% ...#..
      %% ...#..
      %% ...#..
      %% ...#..
      %% ...#..
      %% #..#..
      %% .##...
      %% ......    

      char K c,
      %% #...#.
      %% #..#..
      %% #.#...
      %% ##....
      %% #.#...
      %% #..#..
      %% #...#.
      %% ......    

      char L c,
      %% #.....
      %% #.....
      %% #.....
      %% #.....
      %% #.....
      %% #.....
      %% #####.
      %% ......    

      char M c,
      %% #...#.
      %% ##.##.
      %% ##.##.
      %% #.#.#.
      %% #...#.
      %% #...#.
      %% #...#.
      %% ......    
      
      char N c,
      %% #...#.
      %% ##..#.
      %% ##..#.
      %% #.#.#.
      %% #..##.
      %% #..##.
      %% #...#.
      %% ......    

      char O c,
      %% .###..
      %% #...#.
      %% #...#.
      %% #...#.
      %% #...#.
      %% #...#.
      %% .###..
      %% ......    

      char P c,
      %% ####..
      %% #...#.
      %% #...#.
      %% ####..
      %% #.....
      %% #.....
      %% #.....
      %% ......    

      char Q c,
      %% .###..
      %% #...#.
      %% #...#.
      %% #...#.
      %% #...#.
      %% #...#.
      %% .###..
      %% ....#.    

      char R c,
      %% ####..
      %% #...#.
      %% #...#.
      %% ####..
      %% #.#...
      %% #..#..
      %% #...#.
      %% ......    

      char S c,
      %% .###..
      %% #...#.
      %% #.....
      %% .###..
      %% ....#.
      %% #...#.
      %% .###..
      %% ......
      
      char T c,
      %% #####.
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ......    

      char U c,
      %% #...#.
      %% #...#.
      %% #...#.
      %% #...#.
      %% #...#.
      %% #...#.
      %% .###..
      %% ......    

      char V c,
      %% #...#.
      %% #...#.
      %% #...#.
      %% .#.#..
      %% .#.#..
      %% ..#...
      %% ..#...
      %% ......    

      char W c,
      %% #...#.
      %% #...#.
      %% #...#.
      %% #.#.#.
      %% .###..
      %% .#.#..
      %% .#.#..
      %% ......    

      char X c,
      %% #...#.
      %% .#.#..
      %% .#.#..
      %% ..#...
      %% .#.#..
      %% .#.#..
      %% #...#.
      %% ......    

      char Y c,
      %% #...#.
      %% #...#.
      %% .#.#..
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ......    

      char Z c,
      %% #####.
      %% ....#.
      %% ...#..
      %% ..#...
      %% .#....
      %% #.....
      %% #####.
      %% ......    

      char [ c,
      %% .###..
      %% .#....
      %% .#....
      %% .#....
      %% .#....
      %% .#....
      %% .###..
      %% ......

      $5C c, \ backslash, in hex here to avoid comment stripping
      %% #.....
      %% .#....
      %% .#....
      %% ..#...
      %% ...#..
      %% ...#..
      %% ....#.
      %% ......    

      char ] c,
      %% .###..
      %% ...#..
      %% ...#..
      %% ...#..
      %% ...#..
      %% ...#..
      %% .###..
      %% ......
      
      char ^ c,
      %% ..#...
      %% .#.#..
      %% #...#.
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......    

      char _ c,
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......
      %% #####.
      %% ......    

      char ` c,
      %% .#....
      %% ..#...
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......
      %% ......

      char a c,
      %% ......
      %% ......
      %% ####..
      %% ....#.
      %% .####.
      %% #..##.
      %% .##.#.
      %% ......    

      char b c,
      %% .#....
      %% .#....
      %% .###..
      %% .#..#.
      %% .#..#.
      %% .#..#.
      %% .###..
      %% ......    

      char c c,
      %% ......
      %% ......
      %% ..##..
      %% .#..#.
      %% .#....
      %% .#..#.
      %% ..##..
      %% ......    

      char d c,
      %% ....#.
      %% ....#.
      %% ..###.
      %% .#..#.
      %% .#..#.
      %% .#..#.
      %% ..###.
      %% ......    

      char e c,
      %% ......
      %% ......
      %% ..##..
      %% .#..#.
      %% .####.
      %% .#....
      %% ..###.
      %% ......    

      char f c,
      %% ..##..
      %% .#....
      %% ####..
      %% .#....
      %% .#....
      %% .#....
      %% .#....
      %% ......    

      char g c,
      %% ......
      %% ......
      %% ..##..
      %% .#..#.
      %% .#..#.
      %% ..###.
      %% ....#.
      %% ..##..    

      char h c,
      %% .#....
      %% .#....
      %% .#....
      %% .###..
      %% .#..#.
      %% .#..#.
      %% .#..#.
      %% ......    

      char i c,
      %% ...#..
      %% ......
      %% ..##..
      %% ...#..
      %% ...#..
      %% ...#..
      %% .####.
      %% ......    

      char j c,
      %% ...#..
      %% ......
      %% ..##..
      %% ...#..
      %% ...#..
      %% ...#..
      %% ...#..
      %% .##...    

      char k c,
      %% .#....
      %% .#....
      %% .#..#.
      %% .#.#..
      %% .##...
      %% .#.#..
      %% .#..#.
      %% ......    

      char l c,
      %% .##...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ...##.
      %% ......    

      char m c,
      %% ......
      %% ......
      %% ##.#..
      %% #.#.#.
      %% #.#.#.
      %% #.#.#.
      %% #.#.#.
      %% ......    

      char n c,
      %% ......
      %% ......
      %% .#.#..
      %% .##.#.
      %% .#..#.
      %% .#..#.
      %% .#..#.
      %% ......    

      char o c,
      %% ......
      %% ......
      %% ..##..
      %% .#..#.
      %% .#..#.
      %% .#..#.
      %% ..##..
      %% ......    

      char p c,
      %% ......
      %% ......
      %% .#.#..
      %% .##.#.
      %% .#..#.
      %% .###..
      %% .#....
      %% .#....    
      
      char q c,
      %% ......
      %% ......
      %% ..#.#.
      %% .#.##.
      %% .#..#.
      %% ..###.
      %% ....#.
      %% ....#.

      char r c,
      %% ......
      %% ......
      %% .#.#..
      %% .##.#.
      %% .#....
      %% .#....
      %% .#....
      %% ......
      
      char s c,
      %% ......
      %% .....
      %% ..###.
      %% .#....
      %% ..##..
      %% ....#.
      %% .###..
      %% ......

      char t c,
      %% ..#...
      %% ..#...
      %% .###..
      %% ..#...
      %% ..#...
      %% ..#...
      %% ...#..
      %% ......    

      char u c,
      %% ......
      %% ......
      %% .#..#.
      %% .#..#.
      %% .#..#.
      %% .#.##.
      %% ..#.#.
      %% ......    

      char v c,
      %% ......
      %% ......
      %% #...#.
      %% #...#.
      %% .#.#..
      %% .#.#..
      %% ..#...
      %% ......    

      char w c,
      %% ......
      %% ......
      %% #...#.
      %% #...#.
      %% #.#.#.
      %% .###..
      %% .#.#..
      %% ......    

      char x c,
      %% ......
      %% ......
      %% #...#.
      %% .#.#..
      %% .###..
      %% .#.#..
      %% #...#.
      %% ......    

      char y c,
      %% ......
      %% ......
      %% #...#.
      %% #...#.
      %% .###..
      %% ...#..
      %% ..#...
      %% .#....

      char z c,
      %% ......
      %% ......
      %% #####.
      %% ...#..
      %% ..#...
      %% .#....
      %% #####.
      %% ......    

      char { c,
      %% ...#..
      %% ..#...
      %% ..#...
      %% .#....
      %% ..#...
      %% ..#...
      %% ...#..
      %% ......

      char | c,
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ..#...
      %% ......

      char } c,
      %% .#....
      %% ..#...
      %% ..#...
      %% ...#..
      %% ..#...
      %% ..#...
      %% .#....
      %% ......

      char ~ c,
      %% ......
      %% ......
      %% ......
      %% .##...
      %% #.#.#.
      %% ..##..
      %% ......
      %% ......    

      0 c,
      
    end-const-bytes
    
  end-module> import

  begin-class simple-font-6x8

    member: my-font

    \ Constructor
    :method new { self -- }
      $20 char-cols char-rows $20 $7E make-font self my-font!
      0 { index }
      begin index char-data c@+ 0<> while
        index char-data c@+ { c }
        1 +to index
        char-rows 0 ?do
          index char-data c@+ i c self my-font@ char-row!
          1 +to index
        loop
      repeat
    ;

    \ Get the column of a character
    :method find-char-col ( c self -- col )
      my-font@ find-char-col
    ;

    \ Get a pixel of a character
    :method raw-pixel@ ( pixel-col pixel-row self -- pixel? )
      my-font@ raw-pixel@
    ;

    \ Draw a character onto a bitmap
    :method draw-char ( c col row op bitmap self -- )
      my-font@ draw-char
    ;

    \ Draw a string onto a bitmap
    :method draw-string ( bytes col row op bitmap self -- )
      my-font@ draw-string
    ;

    \ Get the size of a character
    :method char-dim@ ( c self -- cols rows )
      my-font@ char-dim@
    ;

    \ Get the size of a string
    :method string-dim@ ( bytes self -- cols rows )
      my-font@ string-dim@
    ;

  end-class

end-module
